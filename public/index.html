<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.6">
  <style type="text/css">
    body {background-color: #f1f1f1}
    span.s1 {font-kerning: none}
  </style>
</head>
<body>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b>Scan Student ID and Medication</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b>&lt;label&gt;Nurse Name: &lt;input type="text" id="nurseName" required&gt;&lt;/label&gt;&lt;br&gt;&lt;br&gt;</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b>Shift ID: &lt;input type="text" id="shiftId" required&gt;&lt;br&gt;&lt;br&gt;</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b>Student ID:</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b>Medication Barcode:</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b>Log Administration</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b>&lt;h2&gt;Live Medication Log&lt;/h2&gt;</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b>&lt;div id="live-log"&gt;Loading logs...&lt;/div&gt;</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b>&lt;button id="complete-btn"&gt;✅ Complete Med Pass &amp; Download CSV&lt;/button&gt;</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626; min-height: 29.0px"><span class="s1"><b></b></span><br></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b>&lt;script&gt;</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">  </span>// Persist nurse name in localStorage</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">  </span>const nurseInput = document.getElementById("nurseName");</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">  </span>nurseInput.value = localStorage.getItem("nurseName") || "";</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">  </span>nurseInput.addEventListener("input", () =&gt; {</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">    </span>localStorage.setItem("nurseName", nurseInput.value);</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">  </span>});</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b>&lt;/script&gt;</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b>&lt;script&gt;</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">  </span>function loadLiveLog() {</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">    </span>fetch("/logs")</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">      </span>.then(res =&gt; res.json())</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">      </span>.then(data =&gt; {</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">        </span>const container = document.getElementById("live-log");</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">        </span>container.innerHTML = "";</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626; min-height: 29.0px"><span class="s1"><b></b></span><br></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">        </span>if (!data.length) {</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">          </span>container.textContent = "No logs yet.";</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">          </span>return;</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">        </span>}</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626; min-height: 29.0px"><span class="s1"><b></b></span><br></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">        </span>data.slice(0, 10).forEach(entry =&gt; {</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">          </span>const div = document.createElement("div");</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">          </span>const time = new Date(entry.timestamp).toLocaleString();</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">          </span>div.innerHTML = `&lt;strong&gt;${entry.student_id}&lt;/strong&gt; – ${entry.med_code} &lt;span style="color:gray;"&gt;@ ${time}&lt;/span&gt;`;</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">          </span>container.appendChild(div);</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">        </span>});</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">      </span>})</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">      </span>.catch(err =&gt; {</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">        </span>document.getElementById("live-log").textContent = "Error loading logs.";</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">      </span>});</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">  </span>}</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626; min-height: 29.0px"><span class="s1"><b></b></span><br></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">  </span>loadLiveLog();</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">  </span>setInterval(loadLiveLog, 10000);</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626; min-height: 29.0px"><span class="s1"><b></b></span><br></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">  </span>document.getElementById("complete-btn").addEventListener("click", function () {</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">    </span>if (!confirm("Are you sure you want to complete the med pass and download the log?")) return;</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626; min-height: 29.0px"><span class="s1"><b></b></span><br></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">    </span>fetch("/complete-pass")</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">      </span>.then(res =&gt; res.json())</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">      </span>.then(data =&gt; {</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">        </span>if (!data.length) {</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">          </span>alert("No data to export.");</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">          </span>return;</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">        </span>}</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626; min-height: 29.0px"><span class="s1"><b></b></span><br></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">        </span>const nurseName = document.getElementById("nurseName").value || "Unknown Nurse";</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">        </span>const shiftId = document.getElementById("shiftId").value || "No Shift ID";</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">        </span>const today = new Date().toISOString().slice(0, 10);</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">        </span>const csvHeader = `Nurse Name: ${nurseName}\nShift ID: ${shiftId}\nExport Date: ${today}\n\nStudent ID,Medication Code,Timestamp\n`;</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">        </span>const csvRows = data.map(row =&gt;</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">          </span>`"${row.student_id}","${row.med_code}","${new Date(row.timestamp).toLocaleString()}"`</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">        </span>);</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">        </span>const csvContent = csvHeader + csvRows.join("\n");</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626; min-height: 29.0px"><span class="s1"><b></b></span><br></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">        </span>const blob = new Blob([csvContent], { type: "text/csv" });</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">        </span>const url = URL.createObjectURL(blob);</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626; min-height: 29.0px"><span class="s1"><b></b></span><br></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">        </span>const a = document.createElement("a");</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">        </span>a.href = url;</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">        </span>a.download = `med-pass-${today}.csv`;</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">        </span>document.body.appendChild(a);</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">        </span>a.click();</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">        </span>document.body.removeChild(a);</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626; min-height: 29.0px"><span class="s1"><b></b></span><br></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">        </span>setTimeout(() =&gt; {</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">          </span>window.location.href = "/";</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">        </span>}, 1000);</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">      </span>})</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">      </span>.catch(err =&gt; {</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">        </span>alert("Failed to complete med pass: " + err.message);</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">      </span>});</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b><span class="Apple-converted-space">  </span>});</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Helvetica; color: #262626; -webkit-text-stroke: #262626"><span class="s1"><b>&lt;/script&gt;</b></span></h1>
</body>
</html>
